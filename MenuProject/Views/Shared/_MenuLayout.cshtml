@using System.Security.Claims
@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager
@inject IHttpContextAccessor HttpContextAccessor

@{
    var user = HttpContextAccessor.HttpContext.User;
    var menuClaims = user.Claims.Where(c => c.Type == "Menu").ToList();
}
<style>
    .sidebar {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

        .sidebar .nav {
            flex-grow: 1;
        }

        .sidebar .nav-item:last-child {
            margin-top: auto;
        }

</style>
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - MenuProject</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="d-flex">
        <!-- 🔥 Sidebar Başlangıç -->
        <nav class="sidebar bg-dark text-white p-3 vh-100" style="width: 250px;">
            <h4 class="text-center">Menü</h4>
            <ul class="nav flex-column">
                @if (menuClaims.Any())
                {
                    var groupedMenus = new Dictionary<int, List<dynamic>>();

                    foreach (var menuClaim in menuClaims)
                    {
                        var menuParts = menuClaim.Value.Split("/");
                        if (menuParts.Length == 3)
                        {
                            var controller = menuParts[0];
                            var action = menuParts[1];
                            var menuName = menuParts[2];

                            <li class="nav-item">
                                <a class="nav-link text-white" asp-controller="@controller" asp-action="@action">
                                    <i class="fas fa-circle"></i> @menuName
                                </a>
                            </li>
                        }
                    }
                }
                else
                {
                    <li class="nav-item">
                        <span class="nav-link text-muted">Menü bulunamadı</span>
                    </li>
                }
                <!-- 🔥 Çıkış Yap Butonu -->
                <li class="nav-item mt-3">
                    <form asp-controller="Account" asp-action="Logout" method="post">
                        <button type="submit" class="btn btn-danger w-100">
                            <i class="fas fa-sign-out-alt"></i> Çıkış Yap
                        </button>
                    </form>
                </li>
            </ul>
        </nav>
        <!-- 🔥 Sidebar Bitiş -->
        <!-- Ana İçerik Alanı -->
        <div class="container-fluid p-4">
            <main role="main">
                @RenderBody()
            </main>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
